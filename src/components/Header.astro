---
import MenuBtn from "./icons/MenuBtn.astro";
import CloseBtn from "./icons/CloseBtn.astro";
import Logo from "./icons/Logo.astro";
---

<header id="menuContainer" class="flex justify-center items-center py-3 px-4 md:py-4 w-full mx-auto fixed top-0 right-0 left-0 backdrop-blur-xl bg-secondary z-50 border-b border-main/10">
        
	<nav id="menuDesktop" class="hidden md:flex gap-x-4 md:justify-between md:items-center w-full max-w-[1400px] xl:px-4">
    <div>
      <Logo id="logo" class="size-7" />
    </div>
		<div class="flex items-center gap-x-6 font-semibold text-main tracking-tight">
      <a href="#top" class="group relative inline-block hover:text-stone-900 transform transition-all duration-300 hover:-translate-y-0.5">
      <span 
      class="relative z-10">Inicio
      </span>
      <span 
      class="absolute -bottom-px left-0 h-0.5 w-full bg-main/85 transform origin-bottom-right scale-x-0 transition-transform duration-300 ease-out group-hover:origin-bottom-left group-hover:scale-x-100 group-hover:bg-stone-900/90">
      </span>
      </a>
      
      <a href="https://wa.link/cm77za" target="_blank" class="group relative inline-block hover:text-stone-900 transform transition-all duration-300 hover:-translate-y-0.5">
      <span 
      class="relative z-10">Contacto
      </span>
      <span 
      class="absolute -bottom-px left-0 h-0.5 w-full bg-main/85 transform origin-bottom-right scale-x-0 transition-transform duration-300 ease-out group-hover:origin-bottom-left group-hover:scale-x-100 group-hover:bg-stone-900/90">
      </span>
      </a>

      <a href="#postres" class="group relative inline-block hover:text-stone-900 transform transition-all duration-300 hover:-translate-y-0.5">
      <span 
      class="relative z-10">Postres
      </span>
      <span 
      class="absolute -bottom-px left-0 h-0.5 w-full bg-main/85 transform origin-bottom-right scale-x-0 transition-transform duration-300 ease-out group-hover:origin-bottom-left group-hover:scale-x-100 group-hover:bg-stone-900/90">
      </span>
      </a>

      <a href="#pasteles" class="group relative inline-block hover:text-stone-900 transform transition-all duration-300 hover:-translate-y-0.5">
      <span 
      class="relative z-10">Pasteles
      </span>
      <span 
      class="absolute -bottom-px left-0 h-0.5 w-full bg-main/85 transform origin-bottom-right scale-x-0 transition-transform duration-300 ease-out group-hover:origin-bottom-left group-hover:scale-x-100 group-hover:bg-stone-900/90">
      </span>
      </a>

      <a class=" transition-all duration-300 ease-in-out bg-yellow-300 px-3 py-1 rounded-full hover:bg-main hover:text-yellow-200" href="https://wa.link/cm77za" target="_blank">
        Date un gusto!
      </a>
    </div>
	</nav>

	<div id="menuIcons" class="flex justify-between items-center md:hidden w-full py-1">
		<div class="flex items-center gap-x-1">
			<Logo id="logo" class="size-7" />
		</div>
		<button id="menuToggle" aria-expanded="false">
			<MenuBtn id="MenuBtn" class="size-8 text-main" />
			<CloseBtn id="CloseBtn" class="size-8 hidden" />
		</button>
	</div>

</header>

	<nav 
	id="menuResponsive" 
	class="flex flex-col fixed top-0 right-0 left-0 mx-auto px-4 justify-end items-end mt-14 w-full max-w-[1000px] md:hidden backdrop-blur-xl z-40 bg-secondary -translate-y-2 opacity-0 transition duration-200 pointer-events-none tracking-tight font-semibold text-main" 
	aria-hidden="true"
	>

		<a class="py-2 border-b text-right border-main/20 w-full transition duration-200 ease-in-out" href="#top">Inicio</a>
		<a class="py-2 border-b text-right border-main/20 w-full transition duration-200 ease-in-out" href="#postres">Postres</a>
		<a class="py-2 border-b text-right border-main/20 w-full transition duration-200 ease-in-out" href="https://wa.link/cm77za">Contacto</a>
		<a class="py-2 border-b text-right border-main/20 w-full transition duration-200 ease-in-out" href="#pasteles">Pasteles</a>
		<a class="py-2 text-right border-main/20 w-full transition duration-200 ease-in-out" href="https://wa.link/cm77za" target="_blank">Date un gusto!</a>

	</nav>

<script type="module">
document.addEventListener('DOMContentLoaded', () => {
  const btn = document.getElementById('menuToggle');
  const nav = document.getElementById('menuResponsive');
  const iconOpen = document.getElementById('iconOpen');
  const iconClose = document.getElementById('iconClose');

  if (!btn || !nav) return;

  function openMenu() {
    btn.setAttribute('aria-expanded', 'true');
    nav.classList.remove('opacity-0', '-translate-y-2', 'pointer-events-none');
    nav.classList.add('opacity-100', 'translate-y-2');
    nav.setAttribute('aria-hidden', 'false');
    if (iconOpen && iconClose) { iconOpen.classList.add('hidden'); iconClose.classList.remove('hidden'); }
  }

  function closeMenu() {
    btn.setAttribute('aria-expanded', 'false');
    nav.classList.add('opacity-0', '-translate-y-2', 'pointer-events-none');
    nav.classList.remove('opacity-100', 'translate-y-2');
    nav.setAttribute('aria-hidden', 'true');
    if (iconOpen && iconClose) { iconOpen.classList.remove('hidden'); iconClose.classList.add('hidden'); }
  }

  btn.addEventListener('click', (e) => {
    const expanded = btn.getAttribute('aria-expanded') === 'true';
    if (expanded) closeMenu(); else openMenu();
    e.stopPropagation();
  });

  // cerrar al clicar en un enlace
  nav.querySelectorAll('a[href^="#"]').forEach(link => {
    link.addEventListener('click', () => { closeMenu(); });
  });

  // cerrar al clicar fuera del nav (mobile)
  document.addEventListener('click', (e) => {
    const target = e.target;
    if (!nav.contains(target) && !btn.contains(target)) {
      closeMenu();
    }
  });

  // asegurar estado al redimensionar
  window.addEventListener('resize', () => {
    if (window.innerWidth >= 640) { // sm breakpoint
      // en desktop queremos que el responsive nav no interfiera
      nav.classList.add('opacity-0', '-translate-y-2', 'pointer-events-none');
      nav.classList.remove('opacity-100', 'translate-y-0');
      nav.setAttribute('aria-hidden', 'true');
      btn.setAttribute('aria-expanded', 'false');
      if (iconOpen && iconClose) { iconOpen.classList.remove('hidden'); iconClose.classList.add('hidden'); }
    }
  });

  // Manejar scroll suave para enlaces de anclaje
  function handleSmoothScroll(e) {
    const href = e.currentTarget.getAttribute('href');
    if (href && href.startsWith('#')) {
      const targetId = href.substring(1);
      
      // Caso especial para #top - scroll al inicio de la pÃ¡gina
      if (targetId === 'top' || targetId === '') {
        e.preventDefault();
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
        return;
      }
      
      const targetElement = document.getElementById(targetId);
      if (targetElement) {
        e.preventDefault();
        const headerHeight = document.getElementById('menuContainer')?.offsetHeight || 80;
        const elementPosition = targetElement.getBoundingClientRect().top;
        const offsetPosition = elementPosition + window.pageYOffset - headerHeight;
        
        window.scrollTo({
          top: Math.max(0, offsetPosition),
          behavior: 'smooth'
        });
      }
    }
  }

  // Aplicar scroll suave a todos los enlaces de anclaje (desktop y mobile)
  document.querySelectorAll('a[href^="#"]').forEach(link => {
    link.addEventListener('click', handleSmoothScroll);
  });
});
</script>